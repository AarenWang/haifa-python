# haifa_lua æ€§èƒ½åŸºå‡†æµ‹è¯•ç³»ç»Ÿ

## ðŸŽ¯ ç³»ç»Ÿæ¦‚è¿°

æœ¬æµ‹è¯•ç³»ç»Ÿæ—¨åœ¨å®¢è§‚è¯„ä¼° haifa_lua è§£é‡Šå™¨ç›¸å¯¹äºŽå®˜æ–¹ Lua è§£é‡Šå™¨çš„æ€§èƒ½è¡¨çŽ°ï¼Œä¸ºæ€§èƒ½ä¼˜åŒ–æä¾›æ•°æ®æ”¯æŒå’Œæ”¹è¿›æ–¹å‘ã€‚

## ðŸ“ æ–‡ä»¶ç»“æž„

```
benchmark/
â”œâ”€â”€ README.md                    # ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ benchmark_runner.py          # è‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œå™¨  
â”œâ”€â”€ analyze_results.py           # ç»“æžœåˆ†æžä¸ŽæŠ¥å‘Šç”Ÿæˆå™¨
â”œâ”€â”€ scripts/                     # æµ‹è¯•è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ arithmetic_bench.lua     # ç®—æœ¯è¿ç®—æ€§èƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ arithmetic_simple.lua    # ç®€åŒ–ç®—æœ¯æµ‹è¯•(å…¼å®¹haifa_lua)
â”‚   â”œâ”€â”€ function_bench.lua       # å‡½æ•°è°ƒç”¨æ€§èƒ½æµ‹è¯•
â”‚   â””â”€â”€ control_bench.lua        # æŽ§åˆ¶æµæ€§èƒ½æµ‹è¯•
â””â”€â”€ results/                     # æµ‹è¯•ç»“æžœå­˜å‚¨ç›®å½•
    â””â”€â”€ (ç”Ÿæˆçš„JSONç»“æžœæ–‡ä»¶)

docs/
â””â”€â”€ performance_benchmark.md     # è¯¦ç»†æµ‹è¯•æ–¹æ¡ˆæ–‡æ¡£
```

## ðŸš€ å¿«é€Ÿå¼€å§‹

### 1. çŽ¯å¢ƒå‡†å¤‡
```bash
# å®‰è£…å®˜æ–¹ Lua è§£é‡Šå™¨
brew install lua  # macOS

# å®‰è£… Python ä¾èµ–  
pip install psutil

# è¿›å…¥é¡¹ç›®ç›®å½•
cd haifa-python
```

### 2. è¿è¡ŒåŸºå‡†æµ‹è¯•
```bash
# åŸºç¡€æµ‹è¯•
python benchmark/benchmark_runner.py

# é«˜ç²¾åº¦æµ‹è¯• (5æ¬¡è¿­ä»£)
python benchmark/benchmark_runner.py -i 5
```

### 3. åˆ†æžç»“æžœ
```bash
# ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
python benchmark/analyze_results.py benchmark/results/benchmark_results_YYYYMMDD_HHMMSS.json
```

## ðŸ“Š æµ‹è¯•ç»´åº¦

### æ ¸å¿ƒæµ‹è¯•é¡¹ç›®

1. **ç®—æœ¯è¿ç®—æµ‹è¯•** (`arithmetic_bench.lua`)
   - æ•´æ•°è¿ç®—: åŠ å‡ä¹˜é™¤ã€å–æ¨¡è¿ç®—
   - æµ®ç‚¹è¿ç®—: åŸºç¡€æ•°å­¦è®¡ç®—
   - **ç›®æ ‡æ€§èƒ½**: è¾¾åˆ°å®˜æ–¹è§£é‡Šå™¨ 60-80%

2. **å‡½æ•°è°ƒç”¨æµ‹è¯•** (`function_bench.lua`)  
   - é€’å½’è°ƒç”¨: æ–æ³¢é‚£å¥‘æ•°åˆ—è®¡ç®—
   - è¿­ä»£è°ƒç”¨: å¾ªçŽ¯ä¼˜åŒ–æµ‹è¯•
   - æ·±åº¦è°ƒç”¨æ ˆ: æ ˆç®¡ç†æ•ˆçŽ‡
   - **ç›®æ ‡æ€§èƒ½**: è¾¾åˆ°å®˜æ–¹è§£é‡Šå™¨ 50-70%

3. **æŽ§åˆ¶æµæµ‹è¯•** (`control_bench.lua`)
   - æ¡ä»¶åˆ†æ”¯: if/elseif/else æ€§èƒ½
   - åµŒå¥—å¾ªçŽ¯: å¤šå±‚å¾ªçŽ¯ä¼˜åŒ–
   - å¤æ‚æ¡ä»¶: é€»è¾‘è¿ç®—ç»„åˆ
   - **ç›®æ ‡æ€§èƒ½**: è¾¾åˆ°å®˜æ–¹è§£é‡Šå™¨ 60-80%

### è¯„ä¼°æŒ‡æ ‡

- **æ‰§è¡Œæ—¶é—´**: å¹³å‡ã€æœ€å°ã€æœ€å¤§æ‰§è¡Œæ—¶é—´
- **æ€§èƒ½æ¯”çŽ‡**: haifa_lua ç›¸å¯¹äºŽå®˜æ–¹ Lua çš„å€æ•°å…³ç³»
- **ç›¸å¯¹æ€§èƒ½**: haifa_lua è¾¾åˆ°å®˜æ–¹ Lua çš„æ€§èƒ½ç™¾åˆ†æ¯”
- **ç¨³å®šæ€§**: å¤šæ¬¡æ‰§è¡Œçš„æ ‡å‡†å·®

## ðŸ“ˆ æ€§èƒ½ç­‰çº§æ ‡å‡†

| æ€§èƒ½æ¯”çŽ‡ | ç›¸å¯¹æ€§èƒ½ | ç­‰çº§ | è¯„ä»· |
|----------|----------|------|------|
| 1.0x - 1.5x | >66% | ðŸŸ¢ ä¼˜ç§€ | æŽ¥è¿‘å®˜æ–¹è§£é‡Šå™¨æ°´å¹³ |
| 1.5x - 3.0x | 33-66% | ðŸŸ¡ è‰¯å¥½ | é€‚åˆå¤§éƒ¨åˆ†åº”ç”¨åœºæ™¯ |
| 3.0x - 5.0x | 20-33% | ðŸŸ  ä¸€èˆ¬ | éœ€è¦ä¼˜åŒ–ä½†ä»å¯ç”¨ |
| >5.0x | <20% | ðŸ”´ è¾ƒå·® | éœ€è¦é‡ç‚¹ä¼˜åŒ– |

## ðŸ”§ å½“å‰æµ‹è¯•ç»“æžœç¤ºä¾‹

åŸºäºŽç®€åŒ–æµ‹è¯•è„šæœ¬çš„åˆæ­¥ç»“æžœï¼š

```bash
$ lua benchmark/scripts/arithmetic_simple.lua
# Output: ç®—æœ¯è¿ç®—å®Œæˆï¼Œç»“æžœç¨³å®š

$ python -m haifa_lua.cli benchmark/scripts/arithmetic_simple.lua
# Output: Running arithmetic benchmark with operations...
# Results: Integer ops result: 325909950, Float ops result: 325909950
```

**è§‚å¯Ÿç»“æžœ**:
- âœ… haifa_lua èƒ½å¤Ÿæ­£ç¡®æ‰§è¡ŒåŸºç¡€ç®—æœ¯è¿ç®—
- âœ… è®¡ç®—ç»“æžœä¸Žé¢„æœŸä¸€è‡´
- âš ï¸ éœ€è¦å®Œæ•´è®¡æ—¶æ¯”è¾ƒæ‰èƒ½å¾—å‡ºæ€§èƒ½å·®è·

## ðŸ› ï¸ ä¼˜åŒ–æ–¹å‘å»ºè®®

åŸºäºŽæµ‹è¯•æ¡†æž¶è®¾è®¡ï¼Œé¢„æœŸçš„ä¼˜åŒ–é‡ç‚¹ï¼š

### 1. å­—èŠ‚ç æ‰§è¡Œä¼˜åŒ–
- **æŒ‡ä»¤åˆå¹¶**: å°†å¸¸ç”¨æ“ä½œç»„åˆæˆå•ä¸€æŒ‡ä»¤
- **è·³è½¬ä¼˜åŒ–**: å‡å°‘æ¡ä»¶åˆ†æ”¯çš„å¼€é”€
- **å¯„å­˜å™¨åˆ†é…**: ä¼˜åŒ–è™šæ‹Ÿå¯„å­˜å™¨ä½¿ç”¨æ•ˆçŽ‡

### 2. å†…å­˜ç®¡ç†ä¼˜åŒ–  
- **å¯¹è±¡æ± **: å¤ç”¨å¸¸ç”¨å¯¹è±¡ç±»åž‹
- **åžƒåœ¾å›žæ”¶**: ä¼˜åŒ– Python GC å¯¹ VM çš„å½±å“
- **æ ˆç®¡ç†**: å‡å°‘å‡½æ•°è°ƒç”¨æ—¶çš„æ ˆæ“ä½œ

### 3. ç±»åž‹ç³»ç»Ÿä¼˜åŒ–
- **å¿«é€Ÿè·¯å¾„**: ä¸ºå¸¸è§ç±»åž‹æä¾›ä¸“ç”¨å¤„ç†
- **ç±»åž‹æŽ¨æ–­**: å‡å°‘è¿è¡Œæ—¶ç±»åž‹æ£€æŸ¥
- **ç¼“å­˜æœºåˆ¶**: ç¼“å­˜ç±»åž‹è½¬æ¢ç»“æžœ

## ðŸ“‹ ä½¿ç”¨æ³¨æ„äº‹é¡¹

### çŽ¯å¢ƒè¦æ±‚
- Python 3.8+
- Lua 5.4+ (ç”¨äºŽå¯¹æ¯”æµ‹è¯•)
- psutil åº“ (ç”¨äºŽå†…å­˜ç›‘æŽ§)

### å…¼å®¹æ€§è¯´æ˜Ž
- å½“å‰æµ‹è¯•è„šæœ¬éœ€è¦é€‚é… haifa_lua çš„è¯­æ³•æ”¯æŒèŒƒå›´
- éƒ¨åˆ†é«˜çº§è¯­æ³• (å¦‚ `os.clock()`, `string.format()`) å¯èƒ½éœ€è¦ç®€åŒ–
- æµ‹è¯•ç»“æžœä»…åæ˜ å½“å‰å®žçŽ°é˜¶æ®µçš„æ€§èƒ½æ°´å¹³

### æ‰©å±•å»ºè®®
1. **å¢žåŠ æµ‹è¯•ç”¨ä¾‹**: æ ¹æ®å®žé™…åº”ç”¨åœºæ™¯æ·»åŠ æ›´å¤šæµ‹è¯•
2. **é•¿æœŸç›‘æŽ§**: è®¾ç½® CI è‡ªåŠ¨æ‰§è¡Œæ€§èƒ½å›žå½’æµ‹è¯•  
3. **ç»†ç²’åº¦åˆ†æž**: ä½¿ç”¨ profiler åˆ†æžå…·ä½“ç“¶é¢ˆ
4. **å®žé™…åº”ç”¨æµ‹è¯•**: ä½¿ç”¨çœŸå®ž Lua è„šæœ¬è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•

## ðŸŽ¯ é‡Œç¨‹ç¢‘ç›®æ ‡

### çŸ­æœŸç›®æ ‡ (å½“å‰é˜¶æ®µ)
- [ ] åŸºç¡€ç®—æœ¯è¿ç®—è¾¾åˆ°å®˜æ–¹è§£é‡Šå™¨ 70% æ€§èƒ½
- [ ] å‡½æ•°è°ƒç”¨è¾¾åˆ°å®˜æ–¹è§£é‡Šå™¨ 60% æ€§èƒ½
- [ ] å»ºç«‹å®Œæ•´çš„æ€§èƒ½ç›‘æŽ§ä½“ç³»

### ä¸­æœŸç›®æ ‡ (ä¼˜åŒ–é˜¶æ®µ)  
- [ ] ç»¼åˆæ€§èƒ½è¾¾åˆ°å®˜æ–¹è§£é‡Šå™¨ 50% ä»¥ä¸Š
- [ ] å†…å­˜ä½¿ç”¨æŽ§åˆ¶åœ¨å®˜æ–¹è§£é‡Šå™¨ 150% ä»¥å†…
- [ ] æ”¯æŒæ›´å¤šå¤æ‚è¯­æ³•çš„æ€§èƒ½æµ‹è¯•

### é•¿æœŸç›®æ ‡ (æˆç†Ÿé˜¶æ®µ)
- [ ] æ ¸å¿ƒåŠŸèƒ½æ€§èƒ½è¾¾åˆ°å®˜æ–¹è§£é‡Šå™¨ 80% ä»¥ä¸Š
- [ ] å®žçŽ° JIT ç¼–è¯‘ä¼˜åŒ–çƒ­ç‚¹ä»£ç 
- [ ] å»ºç«‹æ€§èƒ½åŸºå‡†æ•°æ®åº“ä¾›ç¤¾åŒºå‚è€ƒ

---

é€šè¿‡è¿™å¥—æ€§èƒ½åŸºå‡†æµ‹è¯•ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥ï¼š
1. **å®¢è§‚è¯„ä¼°** haifa_lua çš„å½“å‰æ€§èƒ½æ°´å¹³
2. **è¯†åˆ«ç“¶é¢ˆ** æ‰¾å‡ºéœ€è¦ä¼˜åŒ–çš„å…³é”®éƒ¨åˆ†  
3. **è·Ÿè¸ªæ”¹è¿›** ç›‘æŽ§ä¼˜åŒ–æŽªæ–½çš„æ•ˆæžœ
4. **æŒ‡å¯¼å¼€å‘** ä¸ºåŽç»­å¼€å‘æä¾›æ•°æ®æ”¯æŒ

è¿™ä¸º haifa_lua é¡¹ç›®çš„æ€§èƒ½ä¼˜åŒ–æä¾›äº†ç§‘å­¦çš„æµ‹é‡å·¥å…·å’Œæ”¹è¿›æ–¹å‘ã€‚